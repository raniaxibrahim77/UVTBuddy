<mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

<mat-card class="page-card">
  <h2>Study Sessions</h2>

  <p *ngIf="!me" class="hint">
  Login from Home page to create, join and leave sessions.
</p>

<p *ngIf="me && isStudent" class="hint">
  You can create, join or leave sessions below.
</p>

<p *ngIf="me && isAdmin" class="hint">
  As an admin, you can create and delete sessions.
</p>

  <p *ngIf="error" class="error">{{ error }}</p>
</mat-card>
<mat-card class="page-card" *ngIf="canCreate">
  <h3>Create a session</h3>

  <div class="grid">
    <mat-form-field appearance="outline">
      <mat-label>Title</mat-label>
      <input matInput [(ngModel)]="title" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Course</mat-label>
      <input matInput [(ngModel)]="course" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Starts at</mat-label>
      <input matInput type="datetime-local" [(ngModel)]="startsAtLocal" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Duration (minutes)</mat-label>
      <input matInput type="number" min="15" max="600" [(ngModel)]="durationMinutes" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Capacity</mat-label>
      <input matInput type="number" min="2" max="50" [(ngModel)]="capacity" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Language (optional)</mat-label>
      <input matInput [(ngModel)]="language" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Location (optional)</mat-label>
      <input matInput [(ngModel)]="locationText" />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full">
      <mat-label>Description (optional)</mat-label>
      <textarea matInput rows="2" [(ngModel)]="description"></textarea>
    </mat-form-field>
  </div>

  <button mat-raised-button color="primary" (click)="create()" [disabled]="creating">
    {{ creating ? 'Creating...' : 'Create' }}
  </button>
</mat-card>

<mat-card class="page-card" *ngIf="sessions.length === 0 && !loading">
  No sessions yet.
</mat-card>

<mat-card class="page-card" *ngFor="let s of sessions">
  <div class="row">
    <div>
      <h3 class="title">{{ s.title }}</h3>
      <div class="meta">
        <b>{{ s.course }}</b>
        ‚Ä¢ {{ s.startsAt | date:'medium' }}
        ‚Ä¢ {{ s.durationMinutes }} min
        ‚Ä¢ cap {{ s.capacity }}
      </div>

      <div *ngIf="s.locationText" class="meta">üìç {{ s.locationText }}</div>
      <div *ngIf="s.language" class="meta">üó£Ô∏è {{ s.language }}</div>

      <p *ngIf="s.description" class="desc">{{ s.description }}</p>
    </div>

<div class="actions">
  <div class="mini">
    {{ s.joinedCount }} / {{ s.capacity }} joined
  </div>

  <button
    mat-stroked-button
    type="button"
    (click)="join(s.id)"
    [disabled]="!me || s.joinedByMe || s.joinedCount >= s.capacity || joiningId === s.id || leavingId === s.id"
  >
    {{ joiningId === s.id ? 'Joining‚Ä¶' : (s.joinedByMe ? 'Joined' : 'Join') }}
  </button>

  <button
    mat-stroked-button
    type="button"
    (click)="leave(s.id)"
    [disabled]="!me || !s.joinedByMe || joiningId === s.id || leavingId === s.id"
  >
    {{ leavingId === s.id ? 'Leaving‚Ä¶' : 'Leave' }}
  </button>

  <button
    *ngIf="isAdmin"
    mat-stroked-button
    color="warn"
    type="button"
    (click)="deleteSession(s.id)"
    [disabled]="joiningId === s.id || leavingId === s.id"
  >
    Delete
  </button>
</div>
  </div>
</mat-card>
